<!DOCTYPE html>
<html>

<head>
	<link rel="shortcut icon" href="img/logo.ico" type="image/x-icon" />
	<meta charset="UTF-8">
	<meta name="format-detection" content="telephone=no">
	<meta name="msapplication-tap-highlight" content="no">
	<meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover">

	<script src="api/api.js"></script>

	<script type="text/javascript" src="utils/fomatting.js"></script>
	<script type="text/javascript" src="utils/addSpace.js"></script>

	<title> Colaborador | Dados de Login </title>
	<link rel="stylesheet" type="text/css" href="css/cadPT3.css">
	<style>
		body {
			background: url("img/fundo4.jpg") no-repeat fixed;
			background-size: 100%;
		}

		hr {
			border: 1px solid #000;
		}

		h4,
		h5 {
			position: relative;
			left: 5px;
		}
	</style>
	<script>

		//A variável "foto" é criada e recebe uma string vazia caso o usuario não adicione uma foto. 
		//O mesmo é com o "certificado".
		foto = "";
		certificado = "";

		//Vai pegar a url, decodificá-la e passar para a variável "uri".
		uri = decodeURIComponent(document.documentURI);

		//A função "formatting(url, array)" vai procurar na url as propriedades que estão no array e retorna seus valores para a variável "info".
		info = formatting(uri, [
			"pt1",
			"cep",
			"rua",
			"numero",
			"bairro",
			"complemento",
			"cidade",
			"estado"
		]);

		//A variável "pt1" recebe o valor do index "0" do array "info" com ".split(string)".
		//O ".split(string)" transforma uma string em array, separando ela onde um caracter(s) da string é igual a string do parametro.
		pt1 = info[0].split(",");

		//O ".splice(position, remove, add)" começa a remover a partir de um determinado index ("position") até a quantidade especificada no "remove" e troca elas pelo "add".
		//Nesse caso só é feito a remoção do index "0".
		info.splice(0, 1);

		//Os valores do "info" são substituidos pelos valores do array "pt1" mais os antigos valores do "info".
		info = [...pt1, ...info];

		//O "addSpace" troca o sinal de soma ("+") por um espaço (" "), pois na decodificação isso não é feito.
		info = addSpace(info);

		//verificando campos
		async function validarCampos() {
			let user = document.getElementById("user").value;
			let senha = document.getElementById("senha").value;
			let confsenha = document.getElementById("confsenha").value;

			if (user == "" || senha == "" || confsenha == "") {
				return alert("Por favor, preencha todos os campos!");
			}

			if (senha != confsenha) {
				return alert("As senhas devem ser iguais!");
			}

			//A variável "data" pegará a data atual do usuário.
			data = new Date;

			//A variável "visto_por_ultimo" formará um array com dois objetos. 
			//O primeiro vai ter dia, mês e ano. 
			//O segundo vai ter hora, minutos e segundos.
			let visto_por_ultimo = [
				{
					dia: data.getDate(),
					mes: data.getMonth() + 1,
					ano: data.getFullYear()
				},
				{
					hora: data.getHours(),
					min: data.getMinutes(),
					seg: data.getSeconds(),
				}
			];

			//Depois é iniciado a função "createUsuario(objeto)" que vai criar a conta do usuario usado o objeto passado no parametro.
			return createUsuario({
				"tipo": "personal",
				"doc": {
					"nome": info[0],
					"sobrenome": info[1],
					"datanasc": info[2],
					"rg": info[3],
					"cpf": info[4],
					"phone": info[5],
					"celular": info[6],
					"cep": info[7],
					"rua": info[8],
					"numero": info[9],
					"bairro": info[10],
					"complemento": info[11],
					"cidade": info[12],
					"estado": info[13],
					"email": user,
					"senha": senha,
					"coords": {
						"Latitude": 0,
						"Longitude": 0,
					},
					"certificado": certificado,
					"foto": foto,
					"visto_por_ultimo": visto_por_ultimo,
					"criado": `
						${visto_por_ultimo[0].dia}/${visto_por_ultimo[0].mes}/${visto_por_ultimo[0].ano} - 
						${visto_por_ultimo[1].hora}:${visto_por_ultimo[1].min}:${visto_por_ultimo[1].seg}
					`,
					"meus_treinos": [],
					"bio": "",
					"comentários": []
				}
			});
		}

		//A função "openFile(event, img)" vai mostrar a imagem escolhida pelo usuario na tela e converte-lá em base64 e coloca-lá na variável "foto" ou certificado.
		//O parametro "event" é a informação passada pelo input sobre o arquivo escolhido.
		//O parametro "img" é o id da tag de img a ser utilizada para mostrar a imagem.
		function openFile(event, img) {

			//A variável "input" vai pegar os arquivos selecionados no input,
			//mas como essa função é ativada só quando selecionar o arquivo,
			//só vai ter um arquivo, se for ativada depois de várias seleções,
			//o "event.target" vai ter uma lista de arquivos.
			var input = event.target;

			//A variável "reader" vai receber a classe "FileReader()",
			//que vai ser usada na conversão de imagem para base64.
			var reader = new FileReader();

			//A função "reader.readAsDataURL(file)" vai converter as informações do "input.files[0]" em base64.
			reader.readAsDataURL(input.files[0]);

			//Quando o reader estiver carregando, vai iniciar uma arrow function.
			reader.onload = function () {

				//A variável "dataURL" vai receber a imagem convertida em "reader.result".
				var dataURL = reader.result;
				console.log(dataURL)

				//A variável "output" vai controlar o elemento de img indicando seu id.
				var output = document.getElementById(img);

				//O "output.scr" recebe a imagem convertida para mostrar em tela.
				output.src = dataURL;

				//Se o parametro "img" for igual a "img_perfil" significa que a imagem é uma foto de perfil,
				//então é retornado a variável "foto" recebendo a imagem convertida,
				//senão é retornado a variável "certificado" recebendo a imagem convertida.
				if (img == "img_perfil") {
					return foto = dataURL;
				}
				return certificado = dataURL;
			};
		};
	</script>
</head>

<body>
	<div class="formulario">
		<center>
			<h2> Ainda não tem conta? <br> Trabalhe Conosco! </h2>
		</center>
		<hr>
		<h4> Dados de Login </h4>
		<hr>
		<center>
			<form id="form" action="./loginPT.html" method="POST"></form>
			<h3>Email: </h3>
			<input type="text" id="user" placeholder="  ex: exemplo@email.com" size="60"> *</input><br /><br />
			<h3>Senha: </h3>
			<input type="password" id="senha" placeholder="  ********" size="30"> *</input><br /><br />
			<h3>Confirme sua senha: </h3>
			<input type="password" id="confsenha" placeholder="  ********" size="30"> *
			<hr><br>
			<p> Insira sua foto de perfil: * </p>
			<br>
			<input type="file" id="perfil" accept="image/*" onchange="openFile(event,'img_perfil')" capture />
			<img id='img_perfil' width="150px" height="150px"><br>
			<hr><br>
			<p> Para confirmarmos que você é um profissional autenticado, precisamos
				<br> de uma foto do seu certificado.<br> Por favor, insira a imagem abaixo: </p>
			<br>
			<input type="file" id="certificado" accept="image/*" onchange="openFile(event,'img_certificado')" capture />
			<img id='img_certificado' width="200px" height="150px"><br>
			<br><br>
			<hr><br>
			<a onclick="validarCampos()" id="cadastro">
				<div class="link0">Cadastrar</div>
			</a> ou
			<a href="loginPT.html">
				<div class="link1">Logue-se</div>
			</a>
		</center><br>
	</div>

	<header>
		<center><img src="img/logo4.png" height="60px" width="60px"></center>
		<a href="cadastroPT.html">
			<div class="voltar"><img src="img/voltar.png" height="25px" width="25px"></img></div>
		</a>
		<center>
			<div class="colaborador">
				COLABORADOR
			</div>
		</center>
	</header>


</body>

</html>